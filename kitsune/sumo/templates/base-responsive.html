{% from 'includes/common_macros.html' import announcement_bar, search_box, aux_nav, favicon with context %}
{% if request.LANGUAGE_CODE == settings.WIKI_DEFAULT_LANGUAGE and waffle.flag('surveygizmo') %}
  {% set SURVEY_GIZMOS = (SURVEY_GIZMOS or ['beacon']) + ['firefox_refresh'] %}
{% endif %}
{% if request.LANGUAGE_CODE == 'xx' %}
  {% set meta = [('robots', 'noindex')] %}
{% endif %}
<!DOCTYPE html>
<html class="no-js" lang="{{ request.LANGUAGE_CODE }}" {% if DIR %}dir="{{ DIR }}"{% endif %}>
<head>
  {% block head_top %}{% endblock %}
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>{% block title %}{% if title %}{{ title }} | {% endif %}{{ _('Mozilla Support', 'site_title') }}{% endblock %}</title>

  {{ favicon() }}

  <link rel="search" type="application/opensearchdescription+xml" title="{{ _('Mozilla Support') }}" href="{{ url('search.plugin') }}"/>
  {% if feeds %}
    {% for feed in feeds %}
      <link rel="alternate" type="application/atom+xml" href="{{ feed[0] }}" title="{{ feed[1] }}"/>
    {% endfor %}
  {% endif %}

  {% stylesheet 'responsive' %}
  {% stylesheet 'print' %}
  {% for style in styles %}
    {% stylesheet style %}
  {% endfor %}

  <link href="//mozorg.cdn.mozilla.net/media/css/tabzilla-min.css" rel="stylesheet" />

  <!--[if lte IE 7]>
    {% stylesheet 'ie' %}
  <![endif]-->
  <!--[if IE 8]>
    {% stylesheet 'ie8' %}
  <![endif]-->

  {% if meta %}
    {% for tag in meta %}
      <meta name="{{ tag[0] }}" content="{{ tag[1] }}"/>
    {% endfor %}
  {% endif %}

  {# This is to verify "we" own the site for some feature on youtube. See bug 992412. #}
  <meta name="google-site-verification" content="2URA-2Y9BeYYUf8B2BSsBSVetJJS3TZwlXBOaMx2VfY" />
  <meta name="google-site-verification" content="U9a6gH32vLIykvntaDToj-ytYhlZ1AfAgVEKstixQIE" />
  {# This is to verify "we" own the site for purposes of Bing/Yahoo search engine features. Bug 1149611 #}
  <meta name="msvalidate.01" content="1659173DC94819093068B0ED7C51C527" />

  {% if refresh %}
    <meta http-equiv="refresh" content="{{ refresh[1] }};url={{ refresh[0] }}"/>
  {% endif %}

  {% if canonical_url %}
    <link rel="canonical" href="{{ canonical_url|safe }}" />
  {% endif %}

  <!--[if lt IE 9]>
{# html5-shiv.js must be inside <head/> to work. #}
<script src="{{ STATIC_URL }}sumo/js/libs/html5-shiv.js"></script>
<![endif]-->
</head>
<body class="responsive html-{{ DIR }} logged-{% if user.is_authenticated() %}in{% else %}out{% endif %} {{ classes }} {{ request.LANGUAGE_CODE }}"
      data-readonly="{{ settings.READ_ONLY|json }}"
      data-usernames-api="{{ url('users.api.usernames') }}"
      data-static-url="{{ STATIC_URL }}"
      data-media-url="{{ MEDIA_URL }}"
      {% if SURVEY_GIZMOS %}
        data-survey-gizmos="{{ SURVEY_GIZMOS|json }}"
      {% else %}
        data-survey-gizmos="[]"
      {% endif %}
      data-ga-push="{{ ga_push_attribute() }}"
      {% if ga_alternate_url %}
        data-ga-alternate-url="{{ ga_alternate_url }}"
      {% endif %}
      data-waffle-refresh-survey="{{ waffle.sample('refresh-survey')|json }}"
{% if extra_body_attrs -%}
  {% for attr, val in extra_body_attrs.items() %}{{ attr }}="{{ val }}" {% endfor %}
{%- endif %}>

{% set locale_picker_url = url('sumo.locales') %}
{% if localizable_url %}
  {% set locale_picker_url = locale_picker_url|urlparams(next=localizable_url) %}
{% endif %}
<ul id="nav-access">
  <li><a href="#main-content">{{ _('Skip to main content') }}</a></li>
  <li><a href="{{ locale_picker_url }}">{{ _('Switch language') }}</a></li>
  <li><a id="skip-to-search" href="#search-q">{{ _('Skip to search') }}</a></li>
</ul>

{% if settings.STAGE %}
  <div id="stage-banner">
    <div class="close-button">X</div>
    {{ _('This is a staging site, the content gets overwritten on the 1st of every month.<br>The production site is <a href="http://support.mozilla.org">here</a>.') }}
  </div>
{% endif %}

<div class="media-test"></div>

<div id="announcements">
  {% call announcement_bar('geoip-suggestion', 'warning') %}{% endcall %}

  {% for announ in get_announcements() %}
    {% call announcement_bar(announ.id, 'warn') %}
      {{ announ.content }}
    {% endcall %}
  {% endfor %}
</div>

<header id="main-header">
  <div class="wrapper cf">
    <a href="http://www.mozilla.org/" id="tabzilla" data-infobar="update">mozilla</a>
    <nav id="aux-nav" role="navigation">
      <ul>
        {{ aux_nav(user, hide_aaq_link) }}
        {% if not hide_locale_switcher %}
          <li><a href="{{ locale_picker_url }}" class="locale-picker">{{ settings.LANGUAGES_DICT[request.LANGUAGE_CODE.lower()] }}</a></li>
        {% endif %}
        {% if show_fx_download and not user.is_authenticated() %}
          <a href="https://www.mozilla.org/en-US/firefox/new/?scene=2&utm_source=support.mozilla.org&utm_medium=referral&utm_campaign=non-fx-button#download-fx"
            class="firefox-download-button" data-ga-click="_trackEvent | Download Button | Firefox button on Thunderbird article">
            <strong class="download-title">{{ _('Download Firefox') }}</strong>
          </a>
        {% endif %}
      </ul>
      <span id="menu-button" data-toggle="menu-open" data-toggle-target="#main-header"></span>
    </nav>
    <a href="{{ url('home') }}" class="logo"><img alt="mozilla support" src="{{ STATIC_URL }}sumo/img/mozilla-support-white.png" /></a>
    {% if not hide_header_search %}
      {{ search_box(settings, id='support-search', params=search_params) }}
    {% endif %}
  </div>
</header>

{% block breadcrumbs %}
  {{ breadcrumbs(crumbs, id='main-breadcrumbs') }}
{% endblock %}

<div class="wrapper cf" id="main-container">
  {% if messages %}
    <ul class="user-messages">
      {% for message in messages %}
        <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  {% block above_main %}{% endblock %}

  {% block outer_side %}
    <aside>
      {% block side_top %}{% endblock %}
      {% block side %}{% endblock %}
      {% block side_bottom %}{% endblock %}
    </aside>
  {% endblock %}

  <main id="main-content" role="main">
    {% block content %}{% endblock %}
  </main>
</div>

<footer>
  <div class="wrapper cf">
    <section>
      <img class="logo" src="{{ STATIC_URL }}sumo/img/mozilla-logo-white.png" alt="Mozilla" />
      <p>
        {% trans %}
          Portions of this content are &copy;1998â€“2015
          <br>by individual mozilla.org contributors. Content
          <br>available under a
          <a href="//www.mozilla.org/foundation/licensing/website-content.html">Creative Commons license</a>.
        {% endtrans %}
      </p>
    </section>
    <section>
      <ul class="links-join cf">
        <li><a href="http://www.mozilla.org/contact/spaces/">{{ _('Contact Us') }}</a></li>
        <li class="wrap"><a href="http://www.mozilla.org/about/partnerships/">{{ _('Partner with Us') }}</a></li>
        <li class="clear"><a href="https://sendto.mozilla.org/page/contribute/givenow-seq?preset=2&amp;source=mozillaorg_footer&amp;ref=EOYFR2014&amp;utm_campaign=EOYFR2014&amp;utm_source=mozilla.org&amp;utm_medium=referral&amp;utm_content=mozillaorg_footer" class="donate">{{ _('Donate') }}</a></li>
        <li class="wrap"><a href="http://www.mozilla.org/contribute/friends/">{{ _('Firefox Friends') }}</a></li>
        <li class="clear"><a href="https://wiki.mozilla.org/Webdev/GetInvolved/support.mozilla.org">{{ _('Contribute to this site') }}</a></li>
      </ul>
      <ul class="links-legal cf">
        <li><a href="http://www.mozilla.org/privacy/">{{ _('Privacy') }}</a></li>
        <li class="wrap"><a href="http://www.mozilla.org/privacy/websites/#cookies">{{ _('Cookies') }}</a></li>
        <li class="wrap"><a href="http://www.mozilla.org/about/legal/">{{ _('Legal') }}</a></li>
        <li class="clear"><a href="http://www.mozilla.org/about/legal/fraud-report/">{{ _('Report Trademark Abuse') }}</a></li>
      </ul>
    </section>
    <section>
      <ul class="links-social cf">
        <li>
          Mozilla:
          <ul>
            <li><a href="https://twitter.com/mozilla">Twitter<span> (@mozilla)</span></a></li>
            <li><a href="https://www.facebook.com/mozilla">Facebook<span> (Mozilla)</span></a></li>
          </ul>
        </li>
        <li>
          Firefox:
          <ul>
            <li><a href="https://twitter.com/firefox">Twitter<span> (@firefox)</span></a></li>
            <li><a href="https://www.facebook.com/Firefox">Facebook<span> (Firefox)</span></a></li>
            <li><a href="https://www.youtube.com/firefoxchannel">YouTube<span> (firefoxchannel)</span></a></li>
          </ul>
        </li>
      </ul>
    </section>
  </div>
</footer>{# /#footer #}

{{ csrf() }}

{# TODO: The BUILD_ID_JS changes whenever our js code changes.
   But this should get cached busted whenever a locale is updated.
   It's complicatred to fix. But for now it isn't more broken than
   before. #}
<script src="{{ STATIC_URL }}jsi18n/{{ request.LANGUAGE_CODE|lower }}/javascript.js?{{ BUILD_ID_JS }}"></script>

{# Optimizely script for A/B testing - Bug 850816 #}
{% if waffle.flag('optimizely') %}
  <script src="//cdn.optimizely.com/js/245885873.js"></script>
{% endif %}
{# End Optimizely #}

{% if include_geoip %}
    <script src="//geo.mozilla.org/country.js" type="text/javascript"></script>
{% endif %}

{% javascript 'common' %}
<!--[if (gte IE 6)&(lte IE 8)]>
  {% javascript 'ie6-8' %}
<![endif]-->
{% for script in scripts %}
  {% javascript script %}
{% endfor %}

<script src="//mozorg.cdn.mozilla.net/{{ request.LANGUAGE_CODE }}/tabzilla/tabzilla.js" async></script>

{# Temporary Pontoon testing - bug 812176 #}
{% if settings.STAGE %}
  <script src="https://pontoon.mozilla.org/pontoon.js"></script>
{% endif %}

{% block footer_script %}
{% endblock %}
</body>
</html>
